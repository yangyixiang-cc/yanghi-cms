var me=Object.defineProperty;var H=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var U=(g,n,t)=>n in g?me(g,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[n]=t,D=(g,n)=>{for(var t in n||(n={}))pe.call(n,t)&&U(g,t,n[t]);if(H)for(var t of H(n))ge.call(n,t)&&U(g,t,n[t]);return g};var u=(g,n,t)=>new Promise((k,m)=>{var _=r=>{try{S(t.next(r))}catch(v){m(v)}},w=r=>{try{S(t.throw(r))}catch(v){m(v)}},S=r=>r.done?k(r.value):Promise.resolve(r.value).then(_,w);S((t=t.apply(g,n)).next())});/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css               */import{Y as fe}from"./YTable.9ceb7701.js";import{ah as Y,r as y,d as C,c as z,av as O,w as P,o as _e,f as ve,g as he,i as o,l as R,j as c,a5 as ye,a6 as we,aa as ke,k as F,t as be,Q as Se,m as d,I as xe,_ as Re,aj as Te,ak as Me,aw as De,ai as Ce,F as ze,M as Fe}from"./index.04d82e8d.js";import{R as b}from"./role.d2a5176c.js";import{M as B}from"./menu.de27218f.js";import{_ as Ie}from"./_plugin-vue_export-helper.cdc0426e.js";/* empty css               *//* empty css               *//* empty css               */const Ke={__name:"RoleManager",setup(g){const n=[{title:"\u89D2\u8272\u7F16\u53F7",width:100,dataIndex:"id",key:"id",fixed:"left"},{title:"\u89D2\u8272\u540D\u79F0",width:100,dataIndex:"name",key:"name",fixed:"left"},{title:"\u6743\u9650\u5B57\u7B26",dataIndex:"roleKey",key:"roleKey",width:150},{title:"\u72B6\u6001",dataIndex:"status",key:"status",width:150},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",key:"createTime",type:"time",width:150},{title:"\u64CD\u4F5C",key:"operation",fixed:"right",width:140,align:"center"}],t=Y([]),k=y(""),m=y({}),_=y(!1),w=(e=1,a=5)=>u(this,null,function*(){_.value=!0;const{data:l}=yield b.getRolePage(e,a);if(l.code===200){let p=l.data;m.value=D({},p),t.length=0,t.push(...p.records),_.value=!1}else _.value=!1,d.success("\u83B7\u53D6\u5206\u9875\u6570\u636E\u5931\u8D25\uFF01")}),S=C(()=>({size:"large",current:m.value.current,pageSize:m.value.size,total:m.value.total,pageSizeOptions:["5","10","15"],showTotal:(e,a)=>a[0]+"-"+a[1]+" \u5171"+e+"\u6761",hideOnSinglePage:!1,showQuickJumper:!0,showSizeChanger:!0})),r=y(!1),v=y(!1),L={labelCol:{span:4},wrapperCol:{span:20}},i=z({role:{id:"",name:"",roleKey:"",status:0,remark:"",menuRules:{}}}),N=e=>{console.log("Success:",e)},T=y(),$=()=>{v.value=!0,T.value.validateFields().then(e=>u(this,null,function*(){const a=yield Q(e.role);console.log(a),a.code===200?(v.value=!1,r.value=!1,d.success(a.msg),T.value.resetFields(),i.role={},t.length=0,w(m.value.current,m.value.pageSize)):(d.error(a.msg),v.value=!1)})).catch(e=>{console.log(e),v.value=!1,d.error("\u8BF7\u68C0\u67E5\uFF0C\u586B\u5199\u5FC5\u9009\u9879\uFF01")})},j=O.SHOW_ALL,h=y([]),M=z([]),V={children:"children",label:"name",value:"id"},q=e=>u(this,null,function*(){const{data:a}=yield B.getCheckedMenuTree(e);a.code===200?(h.value.length=0,h.value.push(...a.data)):d.error("\u83B7\u53D6\u89D2\u8272\u5DF2\u9009\u83DC\u5355\u6811\u5931\u8D25")}),A=()=>u(this,null,function*(){const{data:e}=yield B.getMenuTree();e.code===200?(M.length=0,M.push(...e.data)):d.error("\u83B7\u53D6\u83DC\u5355\u6811\u5931\u8D25")});P(h,()=>{console.log("select",h.value)}),P(r,(e,a)=>u(this,null,function*(){e==!0&&(yield A())}));const E=()=>u(this,null,function*(){i.role={},h.value.length=0}),Q=e=>u(this,null,function*(){let a=null;if(k.value=="\u4FEE\u6539\u89D2\u8272"){const{data:l}=yield b.updateRoleOne(e,h.value);a=l}else{const{data:l}=yield b.addRoleOne(e);a=l}return a}),J=()=>{k.value="\u6DFB\u52A0\u89D2\u8272",r.value=!0},W=(e,a)=>u(this,null,function*(){k.value="\u4FEE\u6539\u89D2\u8272",r.value=!0,yield q(a.id),a=Y(a),a.status=Number(a.status),i.role=a}),G=(e,a)=>u(this,null,function*(){const{data:l}=yield b.deleteRoleByRoleId(a);l.code===200?(t.splice(e,1),d.success(l.msg)):d.success(l.msg)}),X=e=>u(this,null,function*(){if(e.length>0){const{data:a}=yield b.betchDeleteRole(e);a.code===200?(d.success(a.msg),t.length=0,w(m.value.current,m.value.pageSize)):d.error(a.msg)}else d.error("\u6CA1\u6709\u9009\u62E9\u4EFB\u4F55\u9879\uFF01")}),Z=C(()=>n.filter(e=>{if(e.key!="operation"&&e.key!="id")return!0})),ee=C(()=>{const e={};return n.forEach(a=>{a.key!="operation"&&a.key!="id"&&(e[a.key]="")}),e}),I=y(!1),f=z({name:"",roleKey:"",status:"",beginTime:"",lastTime:""}),ae=e=>u(this,null,function*(){if(e.reset)w();else{let a="",l="";if(e.createTime&&(a=dayjs(new Date(e.createTime[0].$d)).format("YYYY-MM-DD HH:mm:ss"),l=dayjs(new Date(e.createTime[1].$d)).format("YYYY-MM-DD HH:mm:ss")),console.log(e),e.name==""&&e.status==""&&e.roleKey==""&&a==""&&l==""){d.error("\u8BF7\u81F3\u5C11\u586B\u5199\u4E00\u9879\u5185\u5BB9\uFF01");return}I.value=!0,f.name=e.name,f.status=e.status,f.roleKey=e.roleKey,f.beginTime=e.beginTime,f.lastTime=e.lastTime,K(1,5,e.name,e.roleKey,e.status,a,l)}}),K=(e=1,a=5,...l)=>u(this,null,function*(){_.value=!0;const{data:p}=yield b.getSearchRolePage(1,5,...l);if(p.code===200){let x=p.data;m.value=D({},x),t.length=0,t.push(...x.records),_.value=!1}else _.value=!1,d.success("\u83B7\u53D6\u6A21\u7CCA\u67E5\u8BE2\u5206\u9875\u6570\u636E\u5931\u8D25\uFF01")}),te=e=>{I.value?K(e.current,e.pageSize,f.name,f.roleKey,f.status,f.beginTime,f.lastTime):w(e.current,e.pageSize)};return _e(()=>{w()}),(e,a)=>{const l=xe,p=Re,x=Te,le=Me,oe=De,ne=Ce,se=O,re=ze,ie=Fe;return ve(),he(Se,null,[o(fe,{columns:n,data:R(t),pagination:R(S),title:"\u89D2\u8272\u7BA1\u7406",onDeleteDataById:G,onHandleUpdate:W,onHandleAdd:J,onHandleDelete:X,onHandlePageInfoUpdate:te,onOnSearchFinish:ae,reloadColumns:R(Z),formSearchState:R(ee),tableLoading:_.value},null,8,["data","pagination","reloadColumns","formSearchState","tableLoading"]),o(ie,{"ok-text":" \u786E\u8BA4","cancel-text":"\u53D6\u6D88",visible:r.value,"onUpdate:visible":a[6]||(a[6]=s=>r.value=s),title:k.value,"confirm-loading":v.value,onOk:$,onCancel:E},{default:c(()=>[o(re,ye({ref_key:"roleFormRef",ref:T,model:i},L,{name:"role-from",onFinish:N}),{default:c(()=>[we(o(p,{name:["role","id"]},{default:c(()=>[o(l,{value:i.role.id,"onUpdate:value":a[0]||(a[0]=s=>i.role.id=s)},null,8,["value"])]),_:1},512),[[ke,!1]]),o(p,{name:["role","name"],label:"\u89D2\u8272\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E2D\u6587\uFF01",pattern:/^[\u4e00-\u9fa5]{0,}$/}]},{default:c(()=>[o(l,{value:i.role.name,"onUpdate:value":a[1]||(a[1]=s=>i.role.name=s),placeholder:"\u7528\u6237\u540D"},null,8,["value"])]),_:1}),o(p,{name:["role","roleKey"],label:"\u6743\u9650\u5B57\u7B26",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u4EE5\u5C0F\u5199\u5B57\u6BCD\u5F00\u5934\uFF0C\u5141\u8BB8\u5305\u542B\u4E0B\u5212\u7EBF\u7684\u7F16\u7801\uFF0C\u81F3\u5C114\u4F4D\uFF01",pattern:/^[a-z][a-z_]{3,}$/}]},{default:c(()=>[o(l,{value:i.role.roleKey,"onUpdate:value":a[2]||(a[2]=s=>i.role.roleKey=s)},null,8,["value"])]),_:1}),o(p,{name:["role","status"],label:"\u72B6\u6001"},{default:c(()=>[o(le,{value:i.role.status,"onUpdate:value":a[3]||(a[3]=s=>i.role.status=s)},{default:c(()=>[o(x,{value:0},{default:c(()=>[F("\u6B63\u5E38")]),_:1}),o(x,{value:1},{default:c(()=>[F("\u505C\u7528")]),_:1})]),_:1},8,["value"])]),_:1}),o(p,{name:["role","remark"],label:"\u5907\u6CE8"},{default:c(()=>[o(oe,{value:i.role.remark,"onUpdate:value":a[4]||(a[4]=s=>i.role.remark=s),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u5185\u5BB9","allow-clear":"","show-count":"",maxlength:200},null,8,["value"])]),_:1}),o(p,{placeholder:"\u6CA1\u6709\u83DC\u5355\u6570\u636E",name:["role","menuRules"],label:"\u83DC\u5355\u6743\u9650"},{default:c(()=>[o(se,{value:h.value,"onUpdate:value":a[5]||(a[5]=s=>h.value=s),style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"\u8BF7\u9009\u62E9\u89D2\u8272\u80FD\u7BA1\u7406\u7684\u83DC\u5355","allow-clear":"",multiple:"","show-checked-strategy":R(j),"tree-checkable":"","tree-default-expand-all":"","tree-data":M,fieldNames:V},{tagRender:c(({label:s,closable:ue,onClose:ce,option:de})=>[o(ne,{closable:ue,color:de.color,style:{"margin-right":"3px"},onClose:ce},{default:c(()=>[F(be(s)+"\xA0\xA0 ",1)]),_:2},1032,["closable","color","onClose"])]),_:1},8,["value","show-checked-strategy","tree-data"])]),_:1})]),_:1},16,["model"])]),_:1},8,["visible","title","confirm-loading"])],64)}}},Qe=Ie(Ke,[["__scopeId","data-v-1ab02df5"]]);export{Qe as default};
